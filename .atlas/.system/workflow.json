{
  "$schema": "MemoryAtlas Workflow State Machine v1.1",
  "description": "Document status transitions and validation rules",

  "states": {
    "req": {
      "values": ["Draft", "Active", "Implemented", "Deprecated"],
      "initial": "Draft",
      "terminal": ["Deprecated"]
    },
    "rule": {
      "values": ["Draft", "Active", "Deprecated"],
      "initial": "Draft",
      "terminal": ["Deprecated"]
    },
    "adr": {
      "values": ["Draft", "Accepted", "Superseded"],
      "initial": "Draft",
      "terminal": ["Superseded"]
    },
    "cq": {
      "values": ["Draft", "Verified", "Failed"],
      "initial": "Draft",
      "terminal": ["Verified", "Failed"]
    },
    "run": {
      "values": ["Planned", "Active", "Completed", "Failed", "Blocked"],
      "initial": "Planned",
      "terminal": ["Completed", "Failed"]
    },
    "brief": {
      "values": ["Draft", "Active", "Archived"],
      "initial": "Draft",
      "terminal": ["Archived"]
    }
  },

  "transitions": {
    "req": {
      "Draft->Active": { "trigger": "capture()", "requires": ["decision recorded"] },
      "Active->Implemented": { "trigger": "finish()", "requires": ["run completed", "git hash present"] },
      "Implemented->Deprecated": { "trigger": "superseded()", "requires": [] }
    },
    "adr": {
      "Draft->Accepted": { "trigger": "capture()", "requires": ["decision recorded"] },
      "Accepted->Superseded": { "trigger": "superseded()", "requires": ["replacement ADR"] }
    },
    "run": {
      "Planned->Active": { "trigger": "execute starts", "requires": [] },
      "Active->Completed": { "trigger": "finish()", "requires": ["deliverables exist"] },
      "Active->Failed": { "trigger": "finish(fail=true)", "requires": ["failure reason"] },
      "Active->Blocked": { "trigger": "block()", "requires": ["blocker description"] },
      "Blocked->Active": { "trigger": "unblock()", "requires": [] }
    }
  },

  "completion_rules": {
    "run_completed": {
      "required_fields": ["Git", "Completed"],
      "description": "RUN needs git evidence to be marked Completed"
    },
    "req_implemented": {
      "required_fields": ["Implemented-Git", "Linked-RUN"],
      "description": "REQ needs implementation evidence once marked Implemented"
    }
  }
}
